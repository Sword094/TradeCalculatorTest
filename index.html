<div id="trade-calculator" style="font-family: 'Funnel Display', sans-serif;">
  <div class="trade-container">
    <!-- PLAYER A -->
    <div class="player-section" id="player-a">
      <h2>Player A</h2>
      <div class="pet-box" id="box-a1" onclick="openModal('a', 1)"><span class="plus">+</span></div>
      <div class="pet-box" id="box-a2" onclick="openModal('a', 2)"><span class="plus">+</span></div>
      <div class="pet-box" id="box-a3" onclick="openModal('a', 3)"><span class="plus">+</span></div>
      <div class="pet-box" id="box-a4" onclick="openModal('a', 4)"><span class="plus">+</span></div>
      <div class="pet-box" id="box-a5" onclick="openModal('a', 5)"><span class="plus">+</span></div>

      <div class="summary">
        Total: <span id="total-a">0</span>
        <button class="reset-btn" onclick="resetPlayer('a')">Reset</button>
      </div>
    </div>

    <!-- PLAYER B -->
    <div class="player-section" id="player-b">
      <h2>Player B</h2>
      <div class="pet-box" id="box-b1" onclick="openModal('b', 1)"><span class="plus">+</span></div>
      <div class="pet-box" id="box-b2" onclick="openModal('b', 2)"><span class="plus">+</span></div>
      <div class="pet-box" id="box-b3" onclick="openModal('b', 3)"><span class="plus">+</span></div>
      <div class="pet-box" id="box-b4" onclick="openModal('b', 4)"><span class="plus">+</span></div>
      <div class="pet-box" id="box-b5" onclick="openModal('b', 5)"><span class="plus">+</span></div>

      <div class="summary">
        Total: <span id="total-b">0</span>
        <button class="reset-btn" onclick="resetPlayer('b')">Reset</button>
      </div>
    </div>
  </div>

  <!-- Modal to select pet -->
  <div id="pet-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <div id="pet-options"></div>
    </div>
  </div>
</div>

<style>
  /* Styling */
  body {
    background-color: #000;
    color: #FFA500;
  }

  .trade-container {
    display: flex;
    justify-content: space-around;
    padding: 20px;
  }

  .player-section {
    background: #111;
    padding: 20px;
    border-radius: 15px;
    width: 45%;
    position: relative;
  }

  .pet-box {
    background: #222;
    width: 100px;
    height: 100px;
    margin: 10px;
    display: inline-block;
    border-radius: 15px;
    text-align: center;
    line-height: 100px;
    font-size: 30px;
    color: #FFA500;
    cursor: pointer;
    position: relative;
  }

  .plus {
    font-size: 40px;
    font-weight: bold;
  }

  .summary {
    margin-top: 10px;
    color: #FFA500;
  }

  .reset-btn {
    background: #FFA500;
    border: none;
    padding: 8px 15px;
    margin-top: 10px;
    border-radius: 20px;
    cursor: pointer;
    color: black;
    font-weight: bold;
  }

  /* Modal styling */
  .modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.8);
  }

  .modal-content {
    background-color: #111;
    margin: 15% auto;
    padding: 20px;
    border-radius: 15px;
    width: 80%;
    position: relative;
  }

  .close-btn {
    color: #FFA500;
    font-size: 30px;
    font-weight: bold;
    position: absolute;
    top: 10px;
    right: 20px;
    cursor: pointer;
  }

  .pet-card {
    background: #222;
    padding: 10px;
    border-radius: 10px;
    margin: 10px;
    display: inline-block;
    width: 120px;
    text-align: center;
    cursor: pointer;
  }

  .pet-card img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    margin-bottom: 10px;
    border-radius: 50%;
  }
</style>

<script>
  let pets = [];
  const playerData = { a: {}, b: {} };

  function fetchSheetData() {
    fetch(sheetUrl)
      .then(res => res.text())
      .then(csv => {
        const rows = csv.split("\n").slice(1); // Skip header
        pets = rows.map(row => {
          const matches = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
          if (!matches || matches.length < 2) return null;

          const name = matches[0] ? matches[0].replace(/^"|"$/g, '').trim() : "";
          const value = matches[1] ? parseFloat(matches[1].replace(/^"|"$/g, '').trim()) : 0;
          let image = matches[2] ? matches[2].replace(/^"|"$/g, '').trim() : "";

          image = image.replace(/\s/g, ""); // Remove ALL spaces inside

          return { name, value, image };
        }).filter(p => p && p.name && !isNaN(p.value));
      });
  }

  function openModal(side, box) {
    const modal = document.getElementById("pet-modal");
    const petOptions = document.getElementById("pet-options");

    // Clear previous options
    petOptions.innerHTML = "";

    pets.forEach(pet => {
      const petCard = document.createElement("div");
      petCard.className = "pet-card";
      petCard.onclick = () => {
        addPet(side, box, pet);
        closeModal();
      };

      petCard.innerHTML = `
        <img src="${pet.image || 'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'}" alt="${pet.name}">
        <div><strong>${pet.name}</strong></div>
      `;

      petOptions.appendChild(petCard);
    });

    modal.style.display = "block";
  }

  function closeModal() {
    const modal = document.getElementById("pet-modal");
    modal.style.display = "none";
  }

  function addPet(side, box, pet) {
    playerData[side][box] = { ...pet };
    updateDisplay(side);
  }

  function updateDisplay(side) {
    let total = 0;
    Object.values(playerData[side]).forEach(pet => {
      total += pet.value;
    });

    document.getElementById(`total-${side}`).textContent = total;
  }

  function resetPlayer(side) {
    playerData[side] = {};
    updateDisplay(side);
  }

  fetchSheetData();
</script>
